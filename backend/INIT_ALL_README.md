# 总初始化脚本使用说明

## 概述

`init_all.py` 是一个总初始化脚本，用于依次执行所有必要的初始化操作，确保系统数据完整性和一致性。

## 功能特性

### 1. 自动化执行
- 按顺序执行多个初始化脚本
- 自动检查脚本文件是否存在
- 统一的错误处理和日志输出

### 2. 执行顺序
脚本按照以下顺序执行：
1. **init_stock_daily.py** - 初始化股票日线数据
2. **init_daily_strategy.py** - 初始化日线策略数据  
3. **init_ths_index_daily.py** - 初始化同花顺指数日线数据

### 3. 安全特性
- 脚本间自动延迟5秒，避免系统负载过高
- 详细的执行日志和错误信息
- 支持用户中断（Ctrl+C）
- 异常处理和错误恢复

## 使用方法

### 1. 直接执行
```bash
cd backend
python3 init_all.py
```

### 2. 使用执行权限
```bash
cd backend
chmod +x init_all.py
./init_all.py
```

### 3. 后台执行
```bash
cd backend
nohup python3 init_all.py > init_all.log 2>&1 &
```

## 执行流程

### 1. 环境检查
- 检查Python版本
- 验证目录结构
- 确认脚本文件存在

### 2. 顺序执行
- 显示执行进度（1/3, 2/3, 3/3）
- 每个脚本执行完成后显示结果
- 脚本间自动等待5秒

### 3. 结果汇总
- 统计成功和失败的脚本数量
- 显示总执行时间
- 提供执行状态总结

## 输出示例

```
🚀 开始执行总初始化脚本
当前时间: 2024-01-15 14:30:00
当前目录: /path/to/backend

📋 进度: 1/3
============================================================
开始执行: 初始化股票日线数据
脚本: init_stock_daily.py
时间: 2024-01-15 14:30:00
============================================================
执行命令: python3 app/scripts/init_stock_daily.py
✅ 初始化股票日线数据 执行成功

⏳ 等待5秒后继续下一个脚本...

📋 进度: 2/3
============================================================
开始执行: 初始化日线策略数据
脚本: init_daily_strategy.py
时间: 2024-01-15 14:30:05
============================================================
执行命令: python3 app/scripts/init_daily_strategy.py
✅ 初始化日线策略数据 执行成功

⏳ 等待5秒后继续下一个脚本...

📋 进度: 3/3
============================================================
开始执行: 初始化同花顺指数日线数据
脚本: init_ths_index_daily.py
时间: 2024-01-15 14:30:10
============================================================
执行命令: python3 app/scripts/init_ths_index_daily.py
✅ 初始化同花顺指数日线数据 执行成功

============================================================
🏁 初始化执行完成
============================================================
总脚本数: 3
成功执行: 3
失败数量: 0
完成时间: 2024-01-15 14:30:15

🎉 所有初始化脚本执行成功！

============================================================
```

## 错误处理

### 1. 脚本不存在
```
❌ 错误: 脚本 app/scripts/init_stock_daily.py 不存在
```

### 2. 执行失败
```
❌ 初始化股票日线数据 执行失败
返回码: 1
错误信息: [具体错误信息]
```

### 3. 异常情况
```
❌ 执行 初始化股票日线数据 时发生异常: [异常详情]
```

## 注意事项

### 1. 执行前准备
- 确保数据库连接正常
- 检查网络连接（如果需要从外部API获取数据）
- 确认有足够的磁盘空间

### 2. 执行环境
- 建议在虚拟环境中执行
- 确保所有依赖包已安装
- 检查Python版本兼容性

### 3. 监控执行
- 关注错误信息和返回码
- 检查日志输出
- 监控系统资源使用情况

### 4. 故障排除
- 如果某个脚本失败，可以单独执行该脚本
- 检查脚本的依赖和配置
- 查看详细的错误日志

## 扩展使用

### 1. 添加新脚本
在 `init_scripts` 列表中添加新的脚本：
```python
init_scripts = [
    ('init_stock_daily.py', '初始化股票日线数据'),
    ('init_daily_strategy.py', '初始化日线策略数据'),
    ('init_ths_index_daily.py', '初始化同花顺指数日线数据'),
    ('new_script.py', '新脚本描述')  # 添加新脚本
]
```

### 2. 自定义延迟时间
修改脚本间的等待时间：
```python
time.sleep(10)  # 改为10秒
```

### 3. 条件执行
添加条件判断，只执行必要的脚本：
```python
if should_run_stock_daily:
    init_scripts.append(('init_stock_daily.py', '初始化股票日线数据'))
```

## 总结

`init_all.py` 脚本提供了一个统一、安全、可监控的初始化解决方案，特别适合：

- **系统部署**: 新环境的数据初始化
- **数据恢复**: 系统故障后的数据重建
- **定期维护**: 定期执行数据更新和同步
- **开发测试**: 开发环境的数据准备

通过使用这个脚本，可以大大简化系统初始化的复杂性，提高操作的可靠性和效率。 